<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Chunri - Admin</title>

    <link rel="stylesheet" href="../assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Cloudinary Widget -->
    <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
</head>

<body>

<!-- HEADER -->
<header class="header">
    <div class="container header-inner">
        <div class="brand">Admin<span style="color:var(--orange)">Panel</span></div>

        <nav class="nav">
            <ul class="nav-list">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="add-product.html" style="color:var(--red);font-weight:700;">Add Product</a></li>
                <li><a href="../products.html">View Store</a></li>
            </ul>
        </nav>
    </div>
</header>

<!-- ADD PRODUCT FORM -->
<div class="container" style="padding:40px 0; max-width:650px;">

    <h2 style="color:var(--red); font-weight:700;">Add New Chunri</h2>

    <form id="productForm" style="
        background:white;
        padding:25px;
        border-radius:12px;
        margin-top:20px;
        box-shadow:0 4px 14px rgba(0,0,0,0.1);
    ">

        <label>Chunri Name</label>
        <input type="text" id="name" required class="input">

        <label>Description</label>
        <textarea id="description" rows="3" class="input"></textarea>

        <label>Price (₹)</label>
        <input type="number" id="price" required class="input">

        <label>Stock</label>
        <input type="number" id="stock" required class="input">

        <label>Cloth Type</label>
        <select id="cloth_type" class="input">
            <option>Cotton</option>
            <option>Silk</option>
            <option>Net</option>
            <option>Satin</option>
            <option>Rayon</option>
        </select>

        <label>Size</label>
        <select id="size" class="input">
            <option>Small</option>
            <option>Medium</option>
            <option>Large</option>
            <option>XL</option>
        </select>

        <label>Design</label>
        <select id="design" class="input">
            <option>Printed</option>
            <option>Embroidery</option>
            <option>Plain</option>
            <option>Traditional</option>
        </select>

        <label>Color</label>
        <select id="color" class="input">
            <option>Red</option>
            <option>Yellow</option>
            <option>Orange</option>
            <option>Pink</option>
            <option>Green</option>
        </select>

        <label>Image</label>
        <button type="button" class="btn primary" onclick="uploadImage()">Upload Image</button>
        <p id="imageStatus" style="margin-top:8px;opacity:.8;">No image uploaded</p>

        <button type="submit" class="btn primary" style="width:100%; margin-top:20px;">
            Add Product
        </button>
    </form>
</div>


<script>
const BASE_URL = "http://localhost:5000";
let uploadedImageURL = "";

// ===============================
// CLOUDINARY IMAGE UPLOAD
// ===============================
function uploadImage() {
    cloudinary.openUploadWidget({
        cloudName: "du7hfexwm",
        uploadPreset: "unsigned_chunri_upload",
        folder: "chunri_products",
        sources: ["local", "camera"],
        multiple: false
    }, (error, result) => {
        if (!error && result && result.event === "success") {
            uploadedImageURL = result.info.secure_url;
            document.getElementById("imageStatus").innerHTML =
                `<span style="color:green;">Image uploaded ✔</span>`;
        }
    });
}


// ===============================
// SUBMIT PRODUCT TO BACKEND
// ===============================
document.getElementById("productForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!uploadedImageURL) {
        alert("Please upload an image!");
        return;
    }

    const product = {
        name: document.getElementById("name").value,
        description: document.getElementById("description").value,
        price: parseFloat(document.getElementById("price").value),
        stock: parseInt(document.getElementById("stock").value),
        cloth_type: document.getElementById("cloth_type").value,
        design: document.getElementById("design").value,
        size: document.getElementById("size").value,
        color: document.getElementById("color").value,
        image_url: uploadedImageURL
    };

    const res = await fetch(`${BASE_URL}/api/product`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(product)
    });

    const data = await res.json();
    alert("Product added successfully!");

    window.location.href = "dashboard.html";
});

if (localStorage.getItem("is_admin") !== "true") {
    alert("Access restricted to admin only!");
    window.location.href = "admin-login.html";
}

</script>

<style>
.input {
    width: 100%;
    padding: 12px;
    margin-bottom: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
}
</style>

</body>
